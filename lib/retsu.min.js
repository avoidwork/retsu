/*
 2014 Jason Mulligan
 @license BSD-3 <https://raw.github.com/avoidwork/retsu/master/LICENSE>
 @link http://avoidwork.github.io/retsu
 @module retsu
 @version 1.0.0
*/
(function(global){var server=typeof process!==undefined,slice=Array.prototype.slice;var array={add:function(obj,arg){if(!array.contains(obj,arg))obj.push(arg);return obj},binIndex:function(obj,arg){var min=0,max=obj.length-1,idx,val;while(min<=max){idx=Math.floor((min+max)/2);val=obj[idx];if(val<arg)min=idx+1;else if(val>arg)max=idx-1;else return idx}return-1},cast:function(obj,key){key=key===true;var o=[];if(!isNaN(obj.length))o=slice.call(obj);else if(key)o=array.keys(obj);else utility.iterate(obj,
function(i){o.push(i)});return o},chunk:function(obj,size){var result=[],nth=number.round(obj.length/size,"up"),start=0,i=-1;while(++i<nth){start=i*size;result.push(array.limit(obj,start,size))}return result},clear:function(obj){return obj.length>0?array.remove(obj,0,obj.length):obj},clone:function(obj){return obj.slice()},contains:function(obj,arg){return obj.indexOf(arg)>-1},collect:function(obj,fn){var result=[];array.each(obj,function(i){result.push(fn(i))});return result},compact:function(obj,
diff){diff=diff===true;var result;result=obj.filter(function(i){return!regex.null_undefined.test(i)});return!diff?result:result.length<obj.length?result:null},count:function(obj,value){return obj.filter(function(i){return i===value}).length},diff:function(obj1,obj2){var result=[];array.each(obj1,function(i){if(!array.contains(obj2,i))array.add(result,i)});array.each(obj2,function(i){if(!array.contains(obj1,i))array.add(result,i)});return result},each:function(obj,fn,async,size){var nth=obj.length,
i,offset;if(async!==true){i=-1;while(++i<nth)if(fn.call(obj,obj[i],i)===false)break}else{size=size||10;offset=0;if(size>nth)size=nth;utility.repeat(function(){var i=-1,idx;while(++i<size){idx=i+offset;if(idx===nth||fn.call(obj,obj[idx],idx)===false)return false}offset+=size;if(offset>=nth)return false},undefined,undefined,false)}return obj},eachReverse:function(obj,fn,async,size){var nth=obj.length,i,offset;if(async!==true){i=nth;while(--i>-1)if(fn.call(obj,obj[i],i)===false)break}else{size=size||
10;offset=nth-1;if(size>nth)size=nth;utility.repeat(function(){var i=-1,idx;while(++i<size){idx=offset-i;if(idx<0||fn.call(obj,obj[idx],idx)===false)return false}offset-=size;if(offset<0)return false},undefined,undefined,false)}return obj},empty:function(obj){return obj.length===0},equal:function(obj1,obj2){return json.encode(obj1)===json.encode(obj2)},fill:function(obj,arg,start,offset){var fn=typeof arg=="function",l=obj.length,i=!isNaN(start)?start:0,nth=!isNaN(offset)?i+offset:l-1;if(nth>l-1)nth=
l-1;while(i<=nth){obj[i]=fn?arg(obj[i]):arg;i++}return obj},first:function(obj){return obj[0]},flat:function(obj){var result=[];result=obj.reduce(function(a,b){return a.concat(b)},result);return result},forEach:function(obj,fn,async,size){return array.each(obj,fn,async,size)},fromObject:function(obj){return array.mingle(array.keys(obj),array.cast(obj))},index:function(obj,arg){return obj.indexOf(arg)},indexed:function(obj){var indexed=[];utility.iterate(obj,function(v){indexed.push(v)});return indexed},
intersect:function(obj1,obj2){var a=obj1.length>obj2.length?obj1:obj2,b=a===obj1?obj2:obj1;return a.filter(function(key){return array.contains(b,key)})},keepIf:function(obj,fn){if(typeof fn!="function")throw new Error(label.invalidArguments);var result=[],remove=[];result=obj.filter(fn);remove=array.diff(obj,result);array.each(remove,function(i){array.remove(obj,array.index(obj,i))});return obj},keys:function(obj){return Object.keys(obj)},keySort:function(obj,query,sub){query=query.replace(/\s*asc/ig,
"").replace(/\s*desc/ig," desc");var queries=string.explode(query).map(function(i){return i.split(" ")}),sorts=[],braceS='["',braceE='"]';if(sub&&sub!=="")sub="."+sub;else sub="";array.each(queries,function(i){var s=".",e="";if(regex.not_dotnotation.test(i[0])){s=braceS;e=braceE}sorts.push("try {");if(i[1]==="desc"){sorts.push("if ( a"+sub+s+i[0]+e+" < b"+sub+s+i[0]+e+" ) return 1;");sorts.push("if ( a"+sub+s+i[0]+e+" > b"+sub+s+i[0]+e+" ) return -1;")}else{sorts.push("if ( a"+sub+s+i[0]+e+" < b"+
sub+s+i[0]+e+" ) return -1;");sorts.push("if ( a"+sub+s+i[0]+e+" > b"+sub+s+i[0]+e+" ) return 1;")}sorts.push("} catch (e) {");sorts.push("try {");sorts.push("if ( a"+sub+s+i[0]+e+" !== undefined ) return "+(i[1]==="desc"?"-1":"1")+";");sorts.push("} catch (e) {}");sorts.push("try {");sorts.push("if ( b"+sub+s+i[0]+e+" !== undefined ) return "+(i[1]==="desc"?"1":"-1")+";");sorts.push("} catch (e) {}");sorts.push("}")});sorts.push("return 0;");return obj.sort(new Function("a","b",sorts.join("\n")))},
last:function(obj,arg){var n=obj.length-1;if(arg>=n+1)return obj;else if(isNaN(arg)||arg===1)return obj[n];else return array.limit(obj,n- --arg,n)},limit:function(obj,start,offset){var result=[],i=start-1,nth=start+offset,max=obj.length;if(max>0)while(++i<nth&&i<max)result.push(obj[i]);return result},max:function(obj){return array.last(obj.sort(array.sort))},mean:function(obj){return obj.length>0?array.sum(obj)/obj.length:undefined},median:function(obj){var nth=obj.length,mid=number.round(nth/2,"down"),
sorted=obj.sort(array.sort);return number.odd(nth)?sorted[mid]:(sorted[mid-1]+sorted[mid])/2},merge:function(obj1,obj2){array.each(obj2,function(i){array.add(obj1,i)});return obj1},min:function(obj){return obj.sort(array.sort)[0]},mingle:function(obj1,obj2){var result;result=obj1.map(function(i,idx){return[i,obj2[idx]]});return result},mode:function(obj){var values={},count=0,mode=[],nth,result;array.each(obj,function(i){if(!isNaN(values[i]))values[i]++;else values[i]=1});count=array.max(array.cast(values));
utility.iterate(values,function(v,k){if(v===count)mode.push(number.parse(k))});nth=mode.length;if(nth>0)result=nth===1?mode[0]:mode;return result},range:function(obj){return array.max(obj)-array.min(obj)},rassoc:function(obj,arg){var result;array.each(obj,function(i,idx){if(i[1]===arg){result=obj[idx];return false}});return result},reject:function(obj,fn){return array.diff(obj,obj.filter(fn))},remove:function(obj,start,end){if(isNaN(start)){start=obj.indexOf(start);if(start===-1)return obj}else start=
start||0;var length=obj.length,remaining=obj.slice((end||start)+1||length);obj.length=start<0?length+start:start;obj.push.apply(obj,remaining);return obj},removeIf:function(obj,fn){var remove;if(typeof fn!="function")throw new Error(label.invalidArguments);remove=obj.filter(fn);array.each(remove,function(i){array.remove(obj,array.index(obj,i))});return obj},removeWhile:function(obj,fn){if(typeof fn!="function")throw new Error(label.invalidArguments);var remove=[];array.each(obj,function(i){if(fn(i)!==
false)remove.push(i);else return false});array.each(remove,function(i){array.remove(obj,array.index(obj,i))});return obj},replace:function(obj1,obj2){array.remove(obj1,0,obj1.length);array.each(obj2,function(i){obj1.push(i)});return obj1},rest:function(obj,arg){arg=arg||1;if(arg<1)arg=1;return array.limit(obj,arg,obj.length)},rindex:function(obj,arg){var result=-1;array.each(obj,function(i,idx){if(i===arg)result=idx});return result},rotate:function(obj,arg){var nth=obj.length,result;if(arg===0)result=
obj;else{if(arg<0)arg+=nth;else arg--;result=array.limit(obj,arg,nth);result=result.concat(array.limit(obj,0,arg))}return result},series:function(start,end,offset){start=start||0;end=end||start;offset=offset||1;var result=[],n=-1,nth=Math.max(0,Math.ceil((end-start)/offset));while(++n<nth){result[n]=start;start+=offset}return result},sort:function(a,b){var types={a:typeof a,b:typeof b},c,d,result;if(types.a==="number"&&types.b==="number")result=a-b;else{c=a.toString();d=b.toString();if(c<d)result=
-1;else if(c>d)result=1;else if(types.a===types.b)result=0;else if(types.a==="boolean")result=-1;else result=1}return result},sorted:function(obj){return obj.sort(array.sort)},split:function(obj,divisor){var result=[],total=obj.length,nth=Math.ceil(total/divisor),low=Math.floor(total/divisor),lower=Math.ceil(total/nth),lowered=false,start=0,i=-1;if(number.diff(total,divisor*nth)>nth)lower=total-low*divisor+low-1;else if(total%divisor>0&&lower*nth>=total)lower--;while(++i<divisor){if(i>0)start=start+
nth;if(!lowered&&lower<divisor&&i===lower){--nth;lowered=true}result.push(array.limit(obj,start,nth))}return result},stddev:function(obj){return Math.sqrt(array.variance(obj))},sum:function(obj){var result=0;if(obj.length>0)result=obj.reduce(function(prev,cur){return prev+cur});return result},take:function(obj,n){return array.limit(obj,0,n)},toObject:function(ar){var obj={},i=ar.length;while(i--)obj[i.toString()]=ar[i];return obj},total:function(obj){return array.indexed(obj).length},unique:function(obj){var result=
[];array.each(obj,function(i){array.add(result,i)});return result},variance:function(obj){var nth=obj.length,n=0,mean;if(nth>0){mean=array.mean(obj);array.each(obj,function(i){n+=math.sqr(i-mean)});return n/nth}else return n},zip:function(obj,args){var result=[];if(!(args instanceof Array))args=typeof args=="object"?array.cast(args):[args];array.each(args,function(i,idx){if(!(i instanceof Array))this[idx]=[i]});array.each(obj,function(i,idx){result[idx]=[i];array.each(args,function(x){result[idx].push(x[idx]||
null)})});return result}};var json={decode:function(arg,silent){try{return JSON.parse(arg)}catch(e){if(silent!==true)utility.error(e,arguments,this);return undefined}},encode:function(arg,silent){try{return JSON.stringify(arg)}catch(e){if(silent!==true)utility.error(e,arguments,this);return undefined}}};var label={expectedNumber:"Expected a Number",invalidArguments:"One or more arguments is invalid"};var math={sqr:function(n){return Math.pow(n,2)}};var number={diff:function(num1,num2){if(isNaN(num1)||
isNaN(num2))throw new Error(label.expectedNumber);return Math.abs(num1-num2)},even:function(arg){return arg%2===0},odd:function(arg){return!number.even(arg)},parse:function(arg,base){return base===undefined?parseFloat(arg):parseInt(arg,base)},round:function(arg,direction){arg=number.parse(arg);if(direction===undefined||string.isEmpty(direction))return number.parse(arg.toFixed(0));else if(regex.down.test(direction))return~~arg;else return Math.ceil(arg)}};var regex={bool:/^(true|false)?$/,down:/down/,
not_dotnotation:/-|\s/,null_undefined:/null|undefined/,primitive:/^(boolean|function|number|string)$/,space_hyphen:/\s|-/,url:/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/i};
var string={explode:function(obj,arg){arg=arg||",";return string.trim(obj).split(new RegExp("\\s*"+arg+"\\s*"))},isEmpty:function(obj){return string.trim(obj)===""},trim:function(obj){return obj.replace(/^(\s+|\t+|\n+)|(\s+|\t+|\n+)$/g,"")}};var utility={timer:{},repeating:{},clearTimers:function(id){if(id===undefined||string.isEmpty(id))throw new Error(label.invalidArguments);if(utility.timer[id]){clearTimeout(utility.timer[id]);delete utility.timer[id]}if(utility.repeating[id]){clearTimeout(utility.repeating[id]);
delete utility.repeating[id]}},clone:function(obj,shallow){var clone;if(shallow===true)return obj!==undefined&&obj!==null?json.decode(json.encode(obj)):obj;else if(!obj||regex.primitive.test(typeof obj)||obj instanceof RegExp)return obj;else if(obj instanceof Array)return obj.slice();else if(!server&&obj instanceof Document)return xml.decode(xml.encode(obj));else if(typeof obj.__proto__!="undefined")return utility.extend(obj.__proto__,obj);else if(obj instanceof Object){clone=json.encode(obj,true);
if(clone!==undefined){clone=json.decode(clone);utility.iterate(obj,function(v,k){if(typeof v=="function")clone[k]=v})}else clone=obj;return clone}else return obj},defer:function(fn,ms,id,repeat){var op;ms=ms||0;repeat=repeat===true;if(id!==undefined)utility.clearTimers(id);else id=utility.uuid(true);op=function(){utility.clearTimers(id);fn()};utility[repeat?"repeating":"timer"][id]=setTimeout(op,ms);return id},error:function(e,args,scope,warning){var o={"arguments":args?array.cast(args):[],message:e.message||
e,number:e.number?e.number&65535:undefined,scope:scope,stack:e.stack||undefined,timestamp:(new Date).toUTCString(),type:e.type||"TypeError"};utility.log(o.stack||o.message,warning!==true?"error":"warn");return undefined},extend:function(obj,arg){var o;if(obj===undefined)throw new Error(label.invalidArguments);o=Object.create(obj);if(arg instanceof Object)utility.merge(o,arg);return o},iterate:function(obj,fn){if(typeof fn!="function")throw new Error(label.invalidArguments);array.each(Object.keys(obj),
function(i){return fn.call(obj,obj[i],i)});return obj},log:function(arg,target){var ts,msg;if(typeof console!="undefined"){ts=typeof arg!="object";msg=ts?"["+(new Date).toLocaleTimeString()+"] "+arg:arg;console[target||"log"](msg)}},merge:function(obj,arg){utility.iterate(arg,function(v,k){if(obj[k]instanceof Array&&v instanceof Array)array.merge(obj[k],v);else if(obj[k]instanceof Object&&v instanceof Object)utility.iterate(v,function(x,y){obj[k][y]=utility.clone(x)});else obj[k]=utility.clone(v)});
return obj},repeat:function(fn,ms,id,now){ms=ms||10;id=id||utility.uuid(true);now=now!==false;if(now&&fn()===false)return;utility.defer(function(){var recursive=function(fn,ms,id){var recursive=this;if(fn()!==false)utility.repeating[id]=setTimeout(function(){recursive.call(recursive,fn,ms,id)},ms);else delete utility.repeating[id]};recursive.call(recursive,fn,ms,id)},ms,id,true);return id},uuid:function(strip){var s=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},r=[8,9,"a",
"b"],o;o=s()+s()+"-"+s()+"-4"+s().substr(0,3)+"-"+r[Math.floor(Math.random()*4)]+s().substr(0,3)+"-"+s()+s()+s();if(strip===true)o=o.replace(/-/g,"");return o}};var xml={decode:function(arg){if(typeof arg!="string"||string.isEmpty(arg))throw new Error(label.invalidArguments);return(new DOMParser).parseFromString(arg,"text/xml")},encode:function(arg,wrap){try{if(arg===undefined)throw new Error(label.invalidArguments);wrap=wrap!==false;var x=wrap?"<xml>":"",top=arguments[2]!==false,node;node=function(name,
value){var output="<n>v</n>";output=output.replace("v",regex.cdata.test(value)?"<![CDATA["+value+"]]\x3e":value);return output.replace(/<(\/)?n>/g,"<$1"+name+">")};if(arg!==null&&arg.xml)arg=arg.xml;if(arg instanceof Document)arg=(new XMLSerializer).serializeToString(arg);if(regex.boolean_number_string.test(typeof arg))x+=node("item",arg);else if(typeof arg=="object")utility.iterate(arg,function(v,k){x+=xml.encode(v,typeof v=="object",false).replace(/item|xml/g,isNaN(k)?k:"item")});x+=wrap?"</xml>":
"";if(top)x='<?xml version="1.0" encoding="UTF8"?>'+x;return x}catch(e){utility.error(e,arguments,this);return undefined}},valid:function(arg){return xml.decode(arg).getElementsByTagName("parsererror").length===0}};if(typeof exports!="undefined")module.exports=array;else if(typeof define=="function")define(function(){return array});else global.retsu=array})(this);
//# sourceMappingURL=retsu.map
